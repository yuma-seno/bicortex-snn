# Bi-Cortex SNN (BC-SNN) Technical Specification

**Project Name:** Bi-Cortex SNN
**Target Platform:** Edge Devices (Microcontrollers, FPGA, Mobile)

---

## 1. コンセプト (Concept)

本モデルは、**「高度な推論を行う固定された脳（TC）」**に対し、**「文脈を保持する流動的な脳（MC）」**を付加することで、単純な認識モデルに時間的因果性の理解能力を与えるアーキテクチャである。

### アーキテクチャの核心：役割分担 (Separation of Concerns)
BC-SNNは、物理的な層（Layer）構造を持たず、ニューロンIDによる領域区分（Parcellation）のみで「推論」と「記憶」の役割を分担する。

1.  **思考野 (Thinking Cortex / TC) = [Inference Core]**
    * **役割:** 「現在」の入力に対する高度な認識・判断・行動生成。
    * **特性:** CNNや強力な教師あり学習SNNなどで事前に最適化される。パラメータは固定(Fixed)され、劣化しない。
    * **限界:** ニューロンの重みが動的に更新されないため、時間がたった出来事を考慮できない。

2.  **記憶野 (Memory Cortex / MC) = [Context Buffer]**
    * **役割:** 現在の状況に最も関連する「過去の文脈」を思考野へフィードバックする。
    * **特性:** リアルタイムで可塑的(Plastic)に変化する。それ自体は高度な推論を行わず、連想のみを行う。

---

## 2. ニューロン・アーキテクチャ (Architecture)

全ニューロン数 $N_{total}$ のフラットな配列を定義し、ID範囲によって機能領域を区分する。

### 2.1 領域定義 (Parcellation)

| 領域名 | ID範囲 | 役割 | パラメータ特性 |
| :--- | :--- | :--- | :--- |
| **思考野 (Thinking Cortex / TC)** | $0 \dots N_{th}-1$ | 特徴抽出、概念認識、行動選択 | **固定 (Fixed)** |
| **記憶野 (Memory Cortex / MC)** | $N_{th} \dots N_{total}-1$ | 文脈保持、時系列パターンの統合 | **動的 (Plastic)** |

### 2.2 思考野 (TC) の内部構造
TCは、事前にタスクに応じた教師あり学習（CNNや単純なSNN等）が行われる想定で、以下のサブセットを持つ。

1.  **感覚ニューロン (Sensory):** 外部センサー（視覚・聴覚など）の入力を受け取る。
2.  **概念ニューロン (Concept):** 入力から抽出された特徴（例：「敵」「壁」「特定の音」）に反応する。**※SRG（学習ゲート）の監視対象であり、かつ記憶野からの想起ターゲットとなる。**
3.  **運動ニューロン (Motor):** システムの最終的なアクション信号を出力する。

### 2.3 記憶野 (MC) の構成
* **リザーバ構造:** ニューロン同士がランダムかつスパース（接続率10-20%程度）に相互結合されたリカレント回路。
* **E/Iバランス (Dale's Law):**
    * 興奮性 (Excitatory): 80%
    * 抑制性 (Inhibitory): 20%
    * ※抑制性ニューロンの導入により、記憶活動の爆発を防ぎ「カオスの縁 (Edge of Chaos)」状態を維持する。

---

## 3. 結合トポロジーと情報の流れ (Connectivity & Flow)

Thinking Cortex (TC) と Memory Cortex (MC) を繋ぐ結合を総称して **Interface** と呼ぶ。本アーキテクチャでは **Interface は固定 (Fixed)** であり、学習は記憶野内部で行われる。

### 3.1 固定結合 (Fixed Connections)
初期化時に設定（またはキャリブレーション）され、運用中は変化しない。

* **Thinking Cortex 内部:**
    * $Sensory \to Concept$: 特徴抽出。
    * $Concept \to Motor$: 事前学習済みの行動生成。
* **Interface (双方向):**
    * **$Concept \to MC$ (Injection):** 現在の概念を記憶野へ投影する。
    * **$MC \to Concept$ (Recall):** 記憶野の特定の活動パターン（アトラクタ）が、特定の概念を**想起（幻視）**させるように調整された結合。
    * ※ これにより、「概念A」に対応する「記憶状態A」が定義される。

### 3.2 可塑的結合 (Plastic Connections) - 連想の形成
**意味的共鳴ゲーティング (SRG)** によってリアルタイムに重みが更新される結合。

* **$MC \to MC$ (Recurrent):** * 記憶野ニューロン同士の結合。
    * ここが更新されることで、ある記憶状態（例：ベル）から、別の記憶状態（例：エサ）への**状態遷移（連想）**確率が変化する。

---

## 4. ダイナミクスと数式 (Dynamics & Math)

### 4.1 ニューロンモデル (LIF)
計算効率を最優先し、Leaky Integrate-and-Fire モデルを採用。

$$v_i(t) = v_i(t-1) \cdot \alpha_{decay} + I_{input}(t) + \sum_{j} w_{ij} S_j(t-1) - A_i(t)$$

* **定数:**
    * 膜時定数 $\tau_m \approx 20.0ms$
    * 発火閾値 $v_{th} = 5.0$ (ノイズ耐性のため高めに設定)
    * 不応期 $t_{ref} = 2.0ms$
* **順応 (Adaptation) $A_i(t)$:**
    * 継続的な発火を抑制するブレーキ項。
    * 発火時に一定値 (`adaptation_step`) 加算され、時定数 `adaptation_tau` (100ms) で減衰する。
    * これにより、想起後の過剰な発火ループを自然に停止させる。
* **発火条件:** $v_i \ge v_{th} + A_i(t)$ ならば $S_i(t)=1, v_i(t)=0$, その後 $t_{ref}$ 期間は不活動。

### 4.2 2つのトレース変数 (Dual Traces)
「土管を見て(原因) $\to$ 数秒後 $\to$ 敵が出る(結果)」といった時間差学習を解決するための機構。

1.  **即時トレース ($x_{fast}$):** $\tau_{fast} = 5.0ms$。
    * 通常のシナプス伝達用。スパイク入力に対する興奮性シナプス後電位(EPSP)の立ち上がりを鋭敏にするため、短く設定される。
2.  **適格性トレース ($e_{slow}$):** $\tau_{slow} = 2000.0ms$ (2.0s)。
    $$e_{slow, i}(t) = e_{slow, i}(t-1) \cdot \exp(-dt/\tau_{slow}) + S_i(t)$$
    * ニューロンが発火すると、そのニューロンには長時間「タグ（発火履歴）」が残る。これにより、未来のターゲット信号が到達した際、過去の原因ニューロンを特定できる。

---

## 5. 学習アルゴリズム: 意味的共鳴ゲーティング (SRG)

### 5.1 ゲート信号 $G(t)$
思考野の**概念ニューロン群 ($Concept$)** の活動総量の**移動平均 (Moving Average)** を監視し、学習の許可証を発行する。

1.  **活動量移動平均:**
    $$A_{ma}(t) = A_{ma}(t-1) \cdot (1 - \alpha_{ma}) + \left(\sum_{k \in TC_{concept}} S_k(t)\right) \cdot \alpha_{ma}$$
    * 平滑化係数 $\alpha_{ma} = 0.2$

2.  **ゲート判定:**
    $$G(t) = 1 \quad \text{if} \quad A_{ma}(t) \ge \theta_{gate} \quad \text{else} \quad 0$$

* **ロジック:** 思考野が継続的かつ明確に「意味のあるもの」を認識した状態でのみ $G(t)=1$ となり、回路の書き換え（記憶）が許可される。

### 5.2 リカレント結合の更新則 ($MC \to MC$)
「文脈」と「現在の体験」を結びつけるための学習則。

$$\Delta w_{mn}(t) = \eta \cdot G(t) \cdot S_{mem, m}(t) \cdot e_{slow, n}(t)$$

* $m, n \in MC$ (Postsynaptic, Presynaptic / 共に記憶野)
* $G(t)$: ゲート信号（思考野で何らかの概念が強く活性化している時のみ 1）
* **解釈:**
    * 重要な概念（エサなど）を認識中 ($G=1$) に、
    * 現在活動している記憶ニューロン $m$（エサの概念によってInjection/Recallループで励起されている）と、
    * 少し前に活動していた記憶ニューロン $n$（ベルの記憶）との結合を強化する。
    * **結果:** 次回からニューロン $n$ が活動するだけで、ニューロン $m$ が発火し、Interface経由でエサの概念が想起される。

---